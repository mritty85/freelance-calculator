# BudgetProfiles Sheet Schema

## Purpose
Stores complete budget calculations with detailed expense breakdowns

## Sheet Name
`BudgetProfiles`

## Columns

| Column | Name | Type | Description | Example |
|--------|------|------|-------------|---------|
| A | budgetProfileId | String | Unique budget profile ID | `budget_x1y2z3w4` |
| B | userId | String | Reference to Users.userId | `user_a1b2c3d4` |
| C | createdAt | ISO DateTime | When budget was calculated | `2025-01-15T10:35:00.000Z` |
| D | personalExpensesJSON | JSON String | Personal expenses breakdown | `{"monthlyTotal": 5500, ...}` |
| E | overheadJSON | JSON String | Business overhead breakdown | `{"healthInsurance": {...}, ...}` |
| F | cashFlowJSON | JSON String | Cash flow buffer calculation | `{"bufferNeeded": 12500, ...}` |
| G | taxesJSON | JSON String | Tax calculation details | `{"federalTax": {...}, ...}` |
| H | summaryJSON | JSON String | Complete budget summary | `{"grossIncomeNeeded": 135570, ...}` |

## Row 1 (Headers)
```
budgetProfileId | userId | createdAt | personalExpensesJSON | overheadJSON | cashFlowJSON | taxesJSON | summaryJSON
```

## Sample Data Row
```
budget_x1y2z3w4 | user_a1b2c3d4 | 2025-01-15T10:35:00.000Z | {...} | {...} | {...} | {...} | {...}
```

## JSON Column Schemas

### personalExpensesJSON
```javascript
{
  "monthlyTotal": 5500,
  "annualTotal": 66000,
  "useSimplified": true,
  "detailed": {
    "essential": 4000,
    "debtSavings": 800,
    "lifestyle": 700
  }
}
```

### overheadJSON
```javascript
{
  "healthInsurance": {
    "needed": true,
    "type": "individual",
    "monthlyPremium": 600,
    "annualCost": 7200,
    "taxDeductible": true
  },
  "retirement": {
    "type": "percentage",
    "percentage": 10,
    "annualCost": 13557
  },
  "businessExpenses": {
    "monthly": 500,
    "annualCost": 6000,
    "detailed": {}
  },
  "professionalDevelopment": {
    "annualCost": 2000
  },
  "pto": {
    "weeks": 2,
    "annualCost": 5200
  },
  "totalAnnualCost": 34957
}
```

### cashFlowJSON
```javascript
{
  "paymentTerms": 30,
  "gapWeeks": 2,
  "bufferMonths": 1.5,
  "bufferNeeded": 8250,
  "annualizedCost": 2750,
  "explanation": "You need 1.5 months of expenses ($8,250) as buffer..."
}
```

### taxesJSON
```javascript
{
  "estimatedGross": 135570,
  "taxableIncome": 70735,
  "selfEmploymentTax": {
    "tax": 14130,
    "deduction": 7065,
    "additionalMedicare": 0,
    "rate": "10.42"
  },
  "federalTax": {
    "tax": 11340,
    "effectiveRate": 16.03,
    "breakdown": [...]
  },
  "stateTax": {
    "tax": 3400,
    "effectiveRate": 4.81,
    "state": "CA"
  },
  "totalTaxBurden": 28870,
  "effectiveTaxRate": 21.3,
  "deductions": {
    "standardDeduction": 15000,
    "seTaxDeduction": 7065,
    "healthInsuranceDeduction": 7200,
    "totalDeductions": 29265
  },
  "iterations": 5,
  "converged": true
}
```

### summaryJSON
```javascript
{
  "desiredTakeHome": 66000,
  "totalOverhead": 37707,
  "totalTaxes": 28870,
  "grossIncomeNeeded": 135570,
  "monthlyTakeHome": 5500,
  "monthlyGrossNeeded": 11298,
  "breakdown": {
    "personalTakeHome": {
      "amount": 66000,
      "percent": 48.7,
      "monthly": 5500
    },
    "businessOverhead": {
      "amount": 37707,
      "percent": 27.8,
      "components": {...}
    },
    "taxes": {
      "amount": 28870,
      "percent": 21.3,
      "components": {...}
    },
    "total": {
      "grossNeeded": 135570,
      "monthlyGross": 11298,
      "monthlyTakeHome": 5500
    }
  }
}
```

## Notes
- budgetProfileId is auto-generated by SheetsDB.gs
- Users can have multiple budget profiles (recalculations)
- Most recent profile for a user is the last row with that userId
- JSON columns allow complex nested data without 50+ columns
- Query on top-level columns (userId, createdAt), store details as JSON

## Indexing
- Primary key: budgetProfileId (Column A)
- Foreign key: userId (Column B) â†’ Users.userId
- Sort by: createdAt (Column C) descending

## Data Retention
- Keep all budget profiles for user history
- Allow users to see previous calculations
- No automatic deletion in MVP
